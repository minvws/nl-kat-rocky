{% load static %}
{% load i18n %}
{% load organization_management %}

{% if request.user.is_authenticated %}
  {% get_organizations request.user as organizations %}
{% endif %}
<header>
  {% include 'partials/skip-to-content.html' %}
  {% include 'partials/page-meta.html' %}
  <nav data-open-label="Menu"
       data-close-label="Sluit menu"
       data-media="(min-width: 56rem)"
       aria-label="Hoofdnavigatie">
    <a href="{% url 'landing_page' %}"
       class="logo"
       title="KAT"
       aria-label="{% translate 'KAT logo, go to the homepage of KAT' %}">
      <img src="{% static 'img/kat_logo.png' %}" alt="{% translate 'KAT' %}"/>
      Kwetsbaarheden Analyse Tool
    </a>
    <!-- Adjust breakpoint as needed -->
    <ul>
      {% if not view_type == "onboarding" %}
        {% if request.user.is_authenticated and organization.code %}
          <li>
            <select id="select-organization" name="select-organization">
              {% for orga in organizations %}
                <option {% if orga.code == organization.code %}selected="{{ organization.code }}"{% endif %}
                        value="{{ orga.code }}">
                  {{ orga.name }}
                </option>
              {% endfor %}
            </select>
          </li>
        {% endif %}
        {% if request.user.is_authenticated %}
          <li>
            <a href="{% url 'crisis_room' %}"
               {% if 'crisis-room' in request.path|urlencode %} aria-current="page"{% endif %}>{% translate 'Crisis room' %}</a>
          </li>
        {% endif %}
        {% if request.user.is_authenticated and organization.code %}
          <li>
            <a href="{% url 'katalogus' organization.code %}"
               {% if 'kat-alogus' in request.path|urlencode %} aria-current="page"{% endif %}>{% translate 'KAT-alogus' %}</a>
          </li>
          <li>
            <a href="{% url 'finding_list' organization.code %}"
               {% if 'finding' in request.path|urlencode %} aria-current="page"{% endif %}>{% translate 'Findings' %}</a>
          </li>
          <li>
            <a href="{% url 'ooi_list' organization.code %}"
               {% if 'objects' in request.path|urlencode %} aria-current="page"{% endif %}>{% translate 'Objects' %}</a>
          </li>
          <li>
            <a href="{% url 'task_list' organization.code %}"
               {% if 'tasks' in request.path|urlencode %} aria-current="page"{% endif %}>{% translate 'Tasks' %}</a>
          </li>
          {% if perms.tools.view_organizationmember and not perms.tools.can_switch_organization %}
            <li>
              <a href="{% url 'organization_member_list' request.user.organizationmember.organization_id %}"
                 {% if 'organizations' in request.path|urlencode %} aria-current="page"{% endif %}>{% translate 'Members' %}</a>
            </li>
          {% endif %}
        {% endif %}
      {% endif %}
      <li class="secondary-menu">{% include 'partials/secondary-menu.html' %}</li>
    </ul>
  </nav>
  {% if breadcrumbs %}
    <nav class="breadcrumb-bar" aria-label="{% translate 'Breadcrumbs' %}">
      <div>
        <ul>
          {% for breadcrumb in breadcrumbs %}
            {% if forloop.last %}
              <li>
                <a aria-current="true" href="{{ breadcrumb.url }}">{{ breadcrumb.text }}</a>
              </li>
            {% else %}
              <li>
                <a href="{{ breadcrumb.url }}">{{ breadcrumb.text }}</a>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    </nav>
  {% endif %}
</header>
{% include 'partials/notifications/confirmation.html' %}
{% block html_at_end_body %}
  <script src="{% static '/js/selectOrganization.js' %}" nonce="{{ request.csp_nonce }}"></script>
{% endblock %}
